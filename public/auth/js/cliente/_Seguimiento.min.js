var OnSuccessRegistroSeguimiento,OnFailureRegistroSeguimiento;function sendMessage(a){window.open("https://api.whatsapp.com/send?phone=+51"+a+"&text=Hola,%20somos%20del%20equipo%20Loayza%20y%20queremos%20ofrecerte...","_blank")}$((function(){const a=$("form#registroSeguimiento"),e=$("#content-history"),i=$(".user-action"),n=$(".user.content-card #carrera_id"),o=$("#turno_id"),t=$("#provincia_id"),d=$("#distrito_id"),l=$("#direccion"),s=$("#horario_id"),r=$(".user-info"),c=$("#sede_id"),p=$("#local_id"),u=$("#sede_adicional_id"),m=$("#local_adicional_id"),v=$("#estado_id"),_=$("#estado_detalle_id"),h=$(".information"),f=$("#nombres"),S=$("#apellidos"),E=$("#id"),A=$("#dni"),g=$("#fecha_nacimiento"),O=$("#celular"),T=$("#whatsapp"),R=$("#email");function D(){$("button[type=submit]").prop("disabled",!0);var e=new FormData;e.append("_token",$("input[name=_token]").val()),e.append("id",E.val()),e.append("nombres",f.val()),e.append("apellidos",S.val()),e.append("fecha_nacimiento",g.val()),e.append("dni",A.val()),e.append("celular",O.val()),e.append("whatsapp",T.val()),e.append("email",R.val()),e.append("carrera_id",n.val()),e.append("provincia_id",t.val()),e.append("distrito_id",d.val()),e.append("direccion",l.val()),e.append("direccion",l.val()),e.append("estado_id",v.val()),e.append("estado_detalle_id",_.val()),$("#carrera_hidden_id").val(n.val()),actionAjax("/cliente/search_course/"+parseInt(n.val()),null,"GET",(function(a){null!=a.data&&a.data.semipresencial&&!$("#datosAdicionales").hasClass("hidden")?$("#datosSemiPresencial").removeClass("hidden").find("select").prop("required",!0):$("#datosSemiPresencial").addClass("hidden").find("select").prop("required",!1)})),actionAjax("/cliente/updateDatosContacto",e,"POST",(function(e){a.find("span[data-valmsg-for]").text(""),e.Success?($("#whatsapp_link").attr("href","javascript:sendMessage("+T.val()+")"),$("#gmail").attr("href","mailto:"+R.val()),toastr.success(e.Message?e.Message:"Guardado Correctamente",e.Title?e.Title:"Éxito")):(toastr.error(e.Message?e.Message:"Algo Salio mal",e.Title?e.Title:"Error"),e.Errors&&$.each(e.Errors,(function(e,i){null!=a&&0!==a.find("span[data-valmsg-for="+e+"]").length&&a.find("span[data-valmsg-for="+e+"]").text(i[0])}))),$("button[type=submit]").prop("disabled",!1)}))}function C(){var a=new FormData;a.append("_token",$("input[name=_token]").val()),a.append("id",E.val()),localStorage.setItem("cliente_id",E.val()),e.html(""),$("#content-history-adicional").html(""),actionAjax("/cliente/list_filter_seguimiento",a,"POST",(function(a){if(null!=a.data&&a.data.length>0){var n="",o=1==a.data.length?1:a.data.length;$.each(a.data,(function(a,e){let i=e.estado_id,t=moment.utc(e.created_at).format("LL").split("de");null!=e.clientes.local_id?n+='<div class="item"><div class="number-image"><div><span>'+o--+'</span></div></div><div class="info-details"><div>'+(e.estado_detalle_id==ESTADOS_DETALLE.MATRICULADO&&usuarioLoggin.profile_id==PERFILES.ADMINISTRADOR?'<button type="button" class="btn btn-primary btn-xs btn-edit pull-right"><i class="fa fa-pencil"></i></button>':"")+'<p class="info-details-title">'+e.clientes.users.name+" realizó "+e.acciones.name+", el "+t[0]+" de "+t[1]+" a las "+moment.utc(e.created_at).format("h:mm a")+" | Estado: "+e.estados.name+" | "+(e.estado_detalle_id==ESTADOS_DETALLE.MATRICULADO?"<br> Matriculado en "+e.clientes.modalidades.name+" de "+e.clientes.carreras.name+", en la sede: "+e.clientes.sedes.name+", en el local: "+e.clientes.locales.name+", en el turno: "+e.clientes.turnos.name+" y en el horario de: "+e.clientes.horarios.horario+" | N° Operación: "+e.clientes.nro_operacion+" | Monto: S/ "+e.clientes.monto+" | Código alumno: "+e.clientes.codigo_alumno+".":e.estado_detalle_id==ESTADOS_DETALLE.REINGRESO?" Semestre de Reingreso: "+e.clientes.semestre_inicio.name+" | Ciclo de Reingreso: "+e.clientes.ciclo_inicio.name+" | Cursos jalados: "+(null!=e.clientes.cursos_jalados&&1==e.clientes.cursos_jalados?"Si":"No"):"")+"</p><p>"+(null!=e.comentario?e.comentario:"-")+"</p></div></div></div>":n+='<div class="item"><div class="number-image"><div><span>'+o--+'</span></div></div><div class="info-details"><div>'+(e.estado_detalle_id==ESTADOS_DETALLE.MATRICULADO&&usuarioLoggin.profile_id==PERFILES.ADMINISTRADOR?'<button type="button" class="btn btn-primary btn-xs btn-edit pull-right"><i class="fa fa-pencil"></i></button>':"")+'<p class="info-details-title">'+e.clientes.users.name+" realizó "+e.acciones.name+", el "+t[0]+" de "+t[1]+" a las "+moment.utc(e.created_at).format("h:mm a")+" | Estado: "+e.estados.name+" | "+(e.estado_detalle_id==ESTADOS_DETALLE.MATRICULADO?"<br> Matriculado en "+e.clientes.modalidades.name+" de "+e.clientes.carreras.name+", en la sede: "+e.clientes.sedes.name+", en el turno: "+e.clientes.turnos.name+" y en el horario de: "+e.clientes.horarios.horario+" | N° Operación: "+e.clientes.nro_operacion+" | Monto: S/ "+e.clientes.monto+" | Código alumno: "+e.clientes.codigo_alumno+".":e.estado_detalle_id==ESTADOS_DETALLE.REINGRESO?" Semestre de Reingreso: "+e.clientes.semestre_inicio.name+" | Ciclo de Reingreso: "+e.clientes.ciclo_inicio.name+" | Cursos jalados: "+(null!=e.clientes.cursos_jalados&&1==e.clientes.cursos_jalados?"Si":"No"):"")+"</p><p>"+(null!=e.comentario?e.comentario:"-")+"</p></div></div></div>",r.find("div.progress-line").each((function(a,e){switch(a+=1){case 1:[ESTADOS.NUEVO].includes(i)&&$(e).addClass("active");break;case 2:[ESTADOS.SEGUIMIENTO,ESTADOS.OPORTUNUDAD,ESTADOS.CIERRE,ESTADOS.REINGRESO].includes(i)&&$(e).addClass("active");break;case 3:[ESTADOS.OPORTUNUDAD,ESTADOS.CIERRE,ESTADOS.REINGRESO].includes(i)&&$(e).addClass("active");break;case 4:[ESTADOS.CIERRE,ESTADOS.REINGRESO].includes(i)&&$(e).addClass("active")}}))})),e.append(n),i.find("input, select, textarea").val(""),$("#proximaAccion").removeClass("hidden").find("input, select").val("").prop("required",!0),$("#datosAdicionales").addClass("hidden").find("input, select").val("").prop("required",!1),null!=a.data&&(a.data[0].clientes.estado_id==ESTADOS.CIERRE||a.data[0].clientes.estado_id==ESTADOS.REINGRESO||[PERFILES.VENDEDOR,PERFILES.CALL].includes(usuarioLoggin.profile_id)&&a.data[0].clientes.estado_id==ESTADOS.OTROS)&&$(".content-actions-client").html(""),l.val(a.data[0].clientes.direccion)}else e.html("<p>No existe historial registrada actualmente.</p>")})),actionAjax("/cliente/list_filter_seguimiento_adicional",a,"POST",(function(a){if(null!=a.data&&a.data.length>0){var e="",i=1==a.data.length?1:a.data.length;$.each(a.data,(function(a,n){null!=n.locales?e+='<div class="item"><div class="number-image"><div><span>'+i--+'</span></div></div><div class="info-details"><div><p class="info-details-title">Nueva matricula: '+n.modalidades.name+" de "+n.carreras.name+", en la sede: "+n.sedes.name+", en el local: "+n.locales.name+", en el turno: "+n.turnos.name+" y en el horario de: "+n.horarios.horario+" | N° Operación: "+n.nro_operacion_adicional+" | Monto: S/ "+n.monto_adicional+". </p></div></div></div></div>":e+='<div class="item"><div class="number-image"><div><span>'+i--+'</span></div></div><div class="info-details"><div><p class="info-details-title">Nueva matricula: '+n.modalidades.name+" de "+n.carreras.name+", en la sede: "+n.sedes.name+", en el turno: "+n.turnos.name+" y en el horario de: "+n.horarios.horario+" | N° Operación: "+n.nro_operacion_adicional+" | Monto: S/ "+n.monto_adicional+". </p></div></div></div></div>"})),$("#content-history-adicional").append(e)}else $("#content-history-adicional").html("<p>Aún no tienes nuevas oportunidades.</p>")}))}$("input.decimal").inputmask("decimal",{min:0,rightAlign:!0,groupSeparator:".",removeMaskOnSubmit:!0,digits:2,autoGroup:!0}),t.change((function(){d.html(""),0!=$(this).val()&&actionAjax("/distrito/filtroDistrito/"+$(this).val(),null,"GET",(function(a){$.each(a,(function(a,e){d.append(`<option value="${e.id}">${e.name}</option>`)})),D()}))})),v.change((function(){_.html("").append('<option value="">-- Seleccione --</option>'),0!=$(this).val()&&actionAjax("/estado/filtroEstado/"+$(this).val(),null,"GET",(function(a){[ESTADOS.PERDIDO,ESTADOS.OTROS].includes(parseInt(v.val()))?($("#proximaAccion").addClass("hidden").find("input, select").val("").prop("required",!1),$("#datosAdicionales").hasClass("hidden")||$("#datosAdicionales").addClass("hidden").find("input, select").val("").prop("required",!1)):[ESTADOS.CIERRE,ESTADOS.REINGRESO].includes(parseInt(v.val()))||($("#proximaAccion").removeClass("hidden").find("input, select").val("").prop("required",!0),$("#datosAdicionales").hasClass("hidden")||$("#datosAdicionales").addClass("hidden").find("input, select").val("").prop("required",!1)),$.each(a,(function(a,e){_.append(`<option value="${e.id}">${e.name}</option>`)}))}))})),$(document).on("change","#turno_id, .user.content-card #carrera_id",(function(){s.html("").append('<option value="">-- Horario --</option>'),0!=$(this).val()&&""!=o.val()&&actionAjax("/horario/filtroHorario/"+o.val()+"/"+n.val()+"/1",null,"GET",(function(a){$.each(a,(function(a,e){s.append(`<option value="${e.id}">${e.horario}</option>`)}))}))})),$(document).on("change","#sede_id",(function(){p.html("").append('<option value="">-- Local --</option>'),0!=$(this).val()&&""!=c.val()&&actionAjax("/local/filtroLocal/"+c.val(),null,"GET",(function(a){$.each(a,(function(a,e){p.append(`<option value="${e.id}">${e.name}</option>`)}))}))})),$(document).on("change","#presencial_turno_id, .user.content-card #carrera_id",(function(){$("#presencial_horario_id").html("").append('<option value="">-- Horario --</option>'),0!=$(this).val()&&""!=$("#presencial_turno_id").val()&&actionAjax("/horario/filtroHorario/"+$("#presencial_turno_id").val()+"/"+n.val()+"/2",null,"GET",(function(a){$.each(a,(function(a,e){$("#presencial_horario_id").append(`<option value="${e.id}">${e.horario}</option>`)}))}))})),$(document).on("change","#estado_id",(function(){[ESTADOS.PERDIDO,ESTADOS.OTROS].includes(parseInt(v.val()))||([ESTADOS.CIERRE,ESTADOS.REINGRESO].includes(parseInt(v.val()))?($("#datosAdicionales").removeClass("hidden").find("input, select").val("").prop("required",!0),$("#proximaAccion").addClass("hidden").find("input, select").val("").prop("required",!1),$(".direccion_matricula").removeClass("hidden").find("input#direccion").val("").prop("required",!0)):($("#proximaAccion").removeClass("hidden").find("input, select").val("").prop("required",!0),$("#datosAdicionales").addClass("hidden").find("input, select").val("").prop("required",!1),$(".direccion_matricula").addClass("hidden").find("input#direccion").val("").prop("required",!1)))})),$(document).on("change","#modalidad_adicional_id",(function(){$("#carrera_adicional_id").html("").append('<option value="">-- Carrera o Curso --</option>'),0!=$(this).val()&&actionAjax("/curso/filtroCurso/"+$(this).val(),null,"GET",(function(a){$.each(a,(function(a,e){$("#carrera_adicional_id").append(`<option value="${e.id}">${e.name}</option>`)}))}))})),$(document).on("change","#sede_adicional_id",(function(){m.html("").append('<option value="">-- Local\n\n         --</option>'),0!=$(this).val()&&""!=u.val()&&actionAjax("/local/filtroLocal/"+u.val(),null,"GET",(function(a){$.each(a,(function(a,e){m.append(`<option value="${e.id}">${e.name}</option>`)}))}))})),$(document).on("change","#turno_adicional_id, #carrera_adicional_id",(function(){$("#horario_adicional_id").html("").append('<option value="">-- Horario --</option>'),0!=$(this).val()&&""!=$("#turno_adicional_id").val()&&actionAjax("/horario/filtroHorario/"+$("#turno_adicional_id").val()+"/"+$("#carrera_adicional_id").val()+"/1",null,"GET",(function(a){$.each(a,(function(a,e){$("#horario_adicional_id").append(`<option value="${e.id}">${e.horario}</option>`)}))}))})),$(document).on("change","#carrera_adicional_id",(function(){const a=$(this);$("#presencial_adicional_sede_id").html("").append('<option value="">-- Sede --</option>'),$("#presencial_adicional_turno_id").html("").append('<option value="">-- Turno --</option>'),$("#presencial_adicional_horario_id").html("").append('<option value="">-- Horario --</option>'),0!=a.val()&&""!=a.val()?actionAjax("/cliente/search_course/"+parseInt(a.val()),null,"GET",(function(a){null!=a.data&&a.data.semipresencial?($("#datosSemiPresencialAdicional").removeClass("hidden").find("select").prop("required",!0),$.each(a.PresencialSedes,(function(a,e){$("#presencial_adicional_sede_id").append(`<option value="${e.id}">${e.name}</option>`)})),$.each(a.turnos,(function(a,e){$("#presencial_adicional_turno_id").append(`<option value="${e.id}">${e.name}</option>`)}))):$("#datosSemiPresencialAdicional").addClass("hidden").find("select").prop("required",!1)})):$("#datosSemiPresencialAdicional").addClass("hidden")})),$(document).on("change","#presencial_adicional_turno_id",(function(){$("#presencial_adicional_horario_id").html("").append('<option value="">-- Horario --</option>'),0!=$(this).val()&&""!=$("#presencial_turno_id").val()&&actionAjax("/horario/filtroHorario/"+$("#presencial_adicional_turno_id").val()+"/"+$("#carrera_adicional_id").val()+"/2",null,"GET",(function(a){$.each(a,(function(a,e){$("#presencial_adicional_horario_id").append(`<option value="${e.id}">${e.horario}</option>`)}))}))})),$(document).on("change",".user.content-card #carrera_id, .information #distrito_id",(function(){D()})),h.find("input:enabled").change((function(){D()})),C(),$(document).on("click",".btn-edit",(function(){invocarModal("/cliente/partialViewMatriculado/"+E.val(),(function(a){"true"===a.attr("data-reload")&&C()}))})),$(".cursosAdicionales button[type=button]").on("click",(function(){$("#datosAdicionales").hasClass("hidden")?$("#datosAdicionales").removeClass("hidden").find("input, select").val("").prop("required",!0):$("#datosAdicionales").addClass("hidden").find("input, select").val("").prop("required",!1)})),OnSuccessRegistroSeguimiento=e=>onSuccessForm(e,a,null,(function(a){a.Success?C():toastr.error("Algo Salio mal","No se pudo actualizar el historial","Error")})),OnFailureRegistroSeguimiento=()=>onFailureForm()}));
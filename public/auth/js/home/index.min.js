var OnSuccessFiltro,OnFailureFiltro;$((function(){const $cliente_id=localStorage.getItem("cliente_id"),$reasignar_id=$("#reasignar_id"),$cards_list=$("#cards-list"),$cards_detail=$("#cards-detail");var $estado_id_filter=$("#estado_id_filter").val(),$vendedor_id=$("#vendedor_id").val(),$name=$("#name").val(),$startDate="",$endDate="";function getAllCheckedLeads(){var array_leads=[];return $cards_list.find('input[type="checkbox"]:checked').each((function(i,item){array_leads[i]=parseInt($(item).attr("id").split("-")[1])})),array_leads}function listarLeads(){function listPagination(reset){const $Page=reset?window.location.origin+"/?page=1":$(".endless-pagination").data("next-page"),$Filters="estado_id="+$estado_id_filter+"&vendedor_id="+$vendedor_id+"&name="+$name+"&fecha_inicio="+$startDate+"&fecha_final="+$endDate;null!==$Page&&(reset?($("#loading-clients").show(),$.get($Page+"&"+$Filters,(function(data){$(".clientes").html("").append(data.clientes),$(".endless-pagination").data("next-page",data.next_page)})).always((function(){$("#loading-clients").hide()}))):(clearTimeout($.data(this,"scrollCheck")),$.data(this,"scrollCheck",setTimeout((function(){$.data(this,"scrollCheck",setTimeout((function(){var scroll_postion_for_clientes_load;$(window).height()+$(window).scrollTop()+100>=$(document).height()&&($("#loading-clients").show(),$.get($Page+"&"+$Filters,(function(data){$(".clientes").append(data.clientes),$(".endless-pagination").data("next-page",data.next_page)})).done((function(){$("#loading-clients").hide()})))})))}),350))))}listPagination(!0),$(window).scroll((function(){pagination&&listPagination(!1)}))}pagination=!0,null!=$cliente_id&&""!=$cliente_id?verSeguimiento($cliente_id):listarLeads(),$reasignar_id.change((function(){if(""!=$(this).val()){var formData=new FormData;formData.append("_token",$("input[name=_token]").val()),formData.append("reasignar_id",$(this).val()),formData.append("array_leads",getAllCheckedLeads()),confirmAjax("/usuario/reasignar",formData,"POST","¿Está seguro de reasignar "+getAllCheckedLeads().length+" Leads a "+$reasignar_id.find("option:selected").text()+" ?",null,(function(data){data.Success?(resetView(),listarLeads()):toastr.error("Hubo un error al hacer la reasignación, vuelva a intentarlo","Error","Error")})),$(this).val("")}})),$("#name").on("keypress",(function(e){13==e.keyCode&&$(".filterSearch").click()})),moment.locale("es");var start=parseInt(moment().format("D"))>=16?moment().startOf("month").add(15,"days"):moment().subtract(1,"month").startOf("month").add(15,"days"),end=parseInt(moment().format("D"))>=16?moment().endOf("month").add(15,"days"):moment().subtract(1,"month").endOf("month").add(15,"days");function cb(start,end){$("#reportrange span").html(start.format("MMMM D, YYYY")+" - "+end.format("MMMM D, YYYY"))}function verSeguimiento($id){invocarVista("/cliente/partialViewSeguimiento/"+$id,(function(data){null!=data&&""!=data?showView(data):toastr.error("El Lead que está búscando no se ha encontrado","Error","Error")}))}function showView(data){pagination=!1,$cards_list.addClass("hidden"),$cards_detail.append(data).removeClass("hidden")}function resetView(){pagination=!0,$cards_list.removeClass("hidden"),$cards_detail.html("").addClass("hidden")}$("#reportrange").daterangepicker({autoUpdateInput:!1,startDate:start,endDate:end,ranges:{Todos:[moment(new Date("2018-01-01")),moment()],Hoy:[moment(),moment()],Ayer:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Últimos 7 días":[moment().subtract(6,"days"),moment()],"Últimos 30 días":[moment().subtract(29,"days"),moment()],"Esta Campaña":[parseInt(moment().format("D"))>=16?moment().startOf("month").add(15,"days"):moment().subtract(1,"month").startOf("month").add(15,"days"),parseInt(moment().format("D"))>=16?moment().endOf("month").add(15,"days"):moment().subtract(1,"month").endOf("month").add(15,"days")],"Este Mes":[moment().startOf("month"),moment().endOf("month")],"Mes Anterior":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"Todo el Año":[moment().subtract(1,"month").startOf("year"),moment().subtract(1,"month").endOf("year")]}},cb),cb(start,end),$("body").on("click",".card button.btn",(function(){const $id=$(this).attr("data-info").split("-")[1];verSeguimiento($id)})),$("body").on("click",".card .btn-delete",(function(){const $id=$(this).attr("data-info").split("-")[1],formData=new FormData;formData.append("_token",$("input[name=_token]").val()),formData.append("id",$id),confirmAjax("/cliente/delete",formData,"POST","¿Está seguro de eliminar el Lead "+$id,null,(function(data){data.Success&&(resetView(),listarLeads())}))})),$("#modalRegistrarInscripcion").on("click",(function(){invocarModal("/cliente/partialView",(function($modal){"true"===$modal.attr("data-reload")&&(resetView(),listarLeads())}))})),$(".filterSearch").on("click",(function(){$estado_id_filter=$("#estado_id_filter").val(),$vendedor_id=$("#vendedor_id").val(),$name=$("#name").val(),$startDate=moment($("#reportrange").data("daterangepicker").startDate._d).format("YYYY-MM-DD"),$endDate=moment($("#reportrange").data("daterangepicker").endDate._d).format("YYYY-MM-DD"),resetView(),listarLeads(),$("#modal-right").modal("hide"),localStorage.setItem("cliente_id","")}))}));
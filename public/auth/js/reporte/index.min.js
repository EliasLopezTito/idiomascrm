$((function(){const $kpis=$("#kpis");let estado=ESTADOS.NUEVO,textoEstado="Registros";moment.locale("es");var $startDate=parseInt(moment().format("D"))>=16?moment().startOf("month").add(15,"days"):moment().subtract(1,"month").startOf("month").add(15,"days"),$endDate=parseInt(moment().format("D"))>=16?moment().endOf("month").add(15,"days"):moment().subtract(1,"month").endOf("month").add(15,"days");function cb($startDate,$endDate){$("#reportrange span").html($startDate.format("MMMM D, YYYY")+" - "+$endDate.format("MMMM D, YYYY"))}function filtrarReporte(estado,actionFull){var formData=new FormData;formData.append("_token",$("input[name=_token]").val()),formData.append("fecha_inicio",moment($("#reportrange").data("daterangepicker").startDate._d).format("YYYY-MM-DD")),formData.append("fecha_final",moment($("#reportrange").data("daterangepicker").endDate._d).format("YYYY-MM-DD")),formData.append("estado_id",estado),formData.append("action_full",actionFull);let $html="";actionFull&&$kpis.html($html),actionAjax("/reporte",formData,"POST",(function(data){$("button.lead-color").text("Registros ("+data.Clientes+")"),estado==ESTADOS.CIERRE?$(".leads-matriculados").removeClass("hidden"):$(".leads-matriculados").addClass("hidden"),actionFull&&($.each(data.EstadosGlobal,(function(i,v){[ESTADOS.PERDIDO,ESTADOS.OTROS,ESTADOS.REASIGNADO].includes(v[3])||($html+='<div><div class="content-count" style="background-color:'+v[2]+'"> '+v[0]+" <br> <span> "+v[1]+" </span></div></div>")})),$kpis.html($html),Highcharts.chart("vision_general_estados",{chart:{type:"column"},title:{text:"Visión General Estados"},subtitle:{text:"Puedes ver más detalle, dandole click a una de las siguientes columnas: "},accessibility:{announceNewData:{enabled:!0}},xAxis:{type:"category"},yAxis:{title:{text:"Registros"}},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"({point.count})"}}},tooltip:{headerFormat:'<span style="font-size:11px">{series.name}</span><br>',pointFormat:'<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> <b> ({point.count})</b> del total<br/>'},series:[{name:"Registros",colorByPoint:!0,data:data.Estados}],drilldown:{series:null}})),Highcharts.chart("enterados",{chart:{type:"column"},title:{text:"¿Cómo te enteraste de Loayza?"},accessibility:{announceNewData:{enabled:!0}},xAxis:{type:"category"},yAxis:{title:{text:"Registros"}},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"({point.count})"}}},tooltip:{headerFormat:'<span style="font-size:11px">{series.name}</span><br>',pointFormat:'<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> <b> ({point.count})</b> del total<br/>'},series:[{name:"Registros",colorByPoint:!0,data:data.Enterados}],drilldown:{series:null}}),Highcharts.chart("usuarios",{chart:{type:"column"},title:{text:"Matrículas por Asesoras"},accessibility:{announceNewData:{enabled:!0}},xAxis:{type:"category"},yAxis:{title:{text:"Registros"}},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"({point.count})"}}},tooltip:{headerFormat:'<span style="font-size:11px">{series.name}</span><br>',pointFormat:'<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> <b> ({point.count})</b> del total<br/>'},series:[{name:"Registros",colorByPoint:!0,data:data.Usuarios}],drilldown:{series:null}}),Highcharts.chart("carreras",{chart:{type:"column"},title:{text:textoEstado+" por Carreras"},accessibility:{announceNewData:{enabled:!0}},xAxis:{type:"category"},yAxis:{title:{text:"Registros"}},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"({point.count})"}}},tooltip:{headerFormat:'<span style="font-size:11px">{series.name}</span><br>',pointFormat:'<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> <b> ({point.count})</b> del total<br/>'},series:[{name:"Registros",colorByPoint:!0,data:data.Carreras}],drilldown:{series:null}}),Highcharts.chart("cursos",{chart:{type:"column"},title:{text:textoEstado+" por Cursos"},accessibility:{announceNewData:{enabled:!0}},xAxis:{type:"category"},yAxis:{title:{text:"Registros"}},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"({point.count})"}}},tooltip:{headerFormat:'<span style="font-size:11px">{series.name}</span><br>',pointFormat:'<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> <b> ({point.count})</b> del total<br/>'},series:[{name:"Registros",colorByPoint:!0,data:data.Cursos}],drilldown:{series:null}}),Highcharts.chart("turnos",{chart:{styledMode:!0},tooltip:{pointFormat:"Registros: <b>{point.y:,.0f}</b>"},plotOptions:{series:{dataLabels:{enabled:!0,format:"<b>{point.name}</b> ({point.y:,.0f})",softConnector:!0},center:["40%","50%"],neckWidth:"30%",neckHeight:"25%",width:"80%"}},title:{text:textoEstado+" por Turnos"},series:[{type:"pie",allowPointSelect:!0,keys:["name","y","selected","sliced"],data:data.Turnos,showInLegend:!0}]}),Highcharts.chart("modalidades",{chart:{styledMode:!0},tooltip:{pointFormat:"Registros: <b>{point.y:,.0f}</b>"},plotOptions:{series:{dataLabels:{enabled:!0,format:"<b>{point.name}</b> ({point.y:,.0f})",softConnector:!0},center:["40%","50%"],neckWidth:"30%",neckHeight:"25%",width:"80%"}},title:{text:textoEstado+" por Modalidades"},series:[{type:"pie",allowPointSelect:!0,keys:["name","y","selected","sliced"],data:data.Modalidades,showInLegend:!0}]}),Highcharts.chart("fuentes",{chart:{type:"column"},title:{text:"Origen de los Registros"},accessibility:{announceNewData:{enabled:!0}},xAxis:{type:"category"},yAxis:{title:{text:"Registros"}},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"({point.count})"}}},tooltip:{headerFormat:'<span style="font-size:11px">{series.name}</span><br>',pointFormat:'<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> <b> ({point.count})</b> del total<br/>'},series:[{name:"Registros",colorByPoint:!0,data:data.Fuentes}],drilldown:{series:null}}),Highcharts.chart("provincias",{chart:{type:"column"},title:{text:textoEstado+" por Provincias"},accessibility:{announceNewData:{enabled:!0}},xAxis:{type:"category"},yAxis:{title:{text:"Registros"}},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"({point.count})"}}},tooltip:{headerFormat:'<span style="font-size:11px">{series.name}</span><br>',pointFormat:'<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> <b> ({point.count})</b> del total<br/>'},series:[{name:"Registros",colorByPoint:!0,data:data.Provincias}],drilldown:{series:null}})}))}$("#reportrange").daterangepicker({autoUpdateInput:!1,startDate:$startDate,endDate:$endDate,ranges:{Hoy:[moment(),moment()],Ayer:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Últimos 7 días":[moment().subtract(6,"days"),moment()],"Últimos 15 días":[moment().subtract(14,"days"),moment()],"Últimos 30 días":[moment().subtract(29,"days"),moment()],"Esta Campaña":[parseInt(moment().format("D"))>=16?moment().startOf("month").add(15,"days"):moment().subtract(1,"month").startOf("month").add(15,"days"),parseInt(moment().format("D"))>=16?moment().endOf("month").add(15,"days"):moment().subtract(1,"month").endOf("month").add(15,"days")],"Este Mes":[moment().startOf("month"),moment().endOf("month")],"Mes Anterior":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"Desde Siempre":[moment(new Date("2018-01-01")),moment()]}},cb),cb($startDate,$endDate),filtrarReporte(estado,!0),$(".list-button button").on("click",(function(){estado=$(this).attr("data-info"),textoEstado=estado==ESTADOS.NUEVO?"Registros":"Matrículas",filtrarReporte(estado,!1)})),$("#reportrange").on("apply.daterangepicker",(function(ev,picker){filtrarReporte(estado,!0)})),$("#btnRealizarFiltro").on("click",(function(){actionAjax("/reporte",formData,"POST",(function(data){Highcharts.chart("pipeLine",{chart:{type:"funnel"},title:{text:"Leads Por Estado"},plotOptions:{series:{dataLabels:{enabled:!0,format:"<b>{point.name}</b> ({point.y:,.0f})",softConnector:!0},center:["40%","50%"],neckWidth:"30%",neckHeight:"25%",width:"80%"}},legend:{enabled:!1},series:[{name:"Leads registradas",data:data.Estados}],responsive:{rules:[{condition:{maxWidth:500},chartOptions:{plotOptions:{series:{dataLabels:{inside:!0},center:["50%","50%"],width:"100%"}}}}]}}),Highcharts.chart("vendedores",{chart:{type:"column"},title:{text:"Lead Por Vendedor"},subtitle:{text:"Puedes ver más detalle, dandole click a una de las siguientes columnas: "},accessibility:{announceNewData:{enabled:!0}},xAxis:{type:"category"},yAxis:{title:{text:"Leads registradas"}},legend:{enabled:!1},plotOptions:{series:{borderWidth:0,dataLabels:{enabled:!0,format:"({point.count})"}}},tooltip:{headerFormat:'<span style="font-size:11px">{series.name}</span><br>',pointFormat:'<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> <b> ({point.count})</b> del total<br/>'},series:[{name:"Leads registradas",colorByPoint:!0,data:data.VendedorEstados}],drilldown:{series:data.VendedorEstadosDetalle}}),$("#modal-right").modal("hide")}))}))}));